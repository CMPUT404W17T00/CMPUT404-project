{% extends 'base.html' %}

{% block title %}Dash{% endblock %}

{% block extra_head %}<link href="/static/css/dash.css" rel="stylesheet">
<link href="/static/css/manager.css" rel="stylesheet">{% endblock %}

{% block content %}

<script src="/static/js/showdown.min.js"></script>
<script src="/static/js/jquery.min.js"></script>

<script>
  function textToImage(contentType, content, replaceId) {
    var image = new Image();
    image.src = "data:" + contentType + "," + content;
    document.getElementById(replaceId).replaceWith(image);
  }
</script>

<script>
  function deletePost(url) {
    $.ajax({
        url: url,
        type: 'DELETE',
        success: function(result) {
          location.reload();
        }
    });
  }
</script>

{% include "addfriend_modal.html" %}

<script>
  function addFriendModal(author, displayName, host) {
    var modal = $("#addfriend");
    modal.find("#displayName").text(displayName);
    modal.find("input[name='author']").val(author);
    modal.find("input[name='displayName']").val(displayName);
    modal.find("input[name='host']").val(host);
    modal.modal("toggle");
  }
</script>

<h1>Your Posts</h1>
<div id='stream'>
{% if latest_post_list %}
  {% for post in latest_post_list %}
    <div class='author_post'>
      {% include "post_template.html" %}
      <form class="form-inline">
        {% csrf_token %}
        <input type="hidden" name="post" value='{{post.id}}'>
        <input type="submit" class="btn btn-default" value="Edit" />
      </form>
      <form method="POST" action="{% url 'dash:deletepost' %}" enctype="multipart/form-data" class="form-inline">
        {% csrf_token %}
        <input type="hidden" name="post" value='{{post.id}}'>
        <input type="submit" class="btn btn-danger" value="Delete" />
      </form>
    </div>
  {% endfor %}
{% else %}
  <p>No posts available.</p>
{% endif %}
</div>

<script>
  var markdownText = document.getElementsByClassName('text/markdown');
  for (var i = 0; i < markdownText.length; ++i) {
    var item = markdownText[i];
    var converter = new showdown.Converter();
    var html = converter.makeHtml(item.innerHTML);
    item.innerHTML = html;
  }
</script>

<script>
  var postLinks = document.getElementsByClassName('post_link');
  for (var i = 0; i < postLinks.length; ++i) {
    var link = postLinks[i];
    link.href = link.href.replace("posts","dash/posts");
  }
</script>


{% endblock %}
